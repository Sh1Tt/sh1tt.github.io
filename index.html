<!DOCTYPE html lang="en">
  <head>
    <meta http-equiv="Content-Type" Content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1.0, viewport-fit=cover" />
    <title>Wallpaper Engine Project | with Binance API</title>
    <style type="text/css">
      :root
      {
        --theme-color: rgb( 255 255 255 / 99 );
        --bg-color: rgb( 8 8 8 / 99 );
      }
      *
      {
        margin:  0;
        padding: 0;
        text-decoration: none;
        list-style: none;
      }
      html, body
      {
        color: var( --theme-color );
        background-color: var( --bg-color );
        font-family: 'roboto', sans-serif;
      }
      #time
      {
        display: flex;
        flex-direction: row;
        flex-wrap:  wrap;
      }
      #time > *
      {
        flex: 1 1 0px;
        min-width: 420px;
        max-width: 640px;
        height: 5em;
        font-size: xxx-large;
        display: grid;
        justify-content: center;
      }

      .group
      {
        display: block;
        position: relative;
        margin: 2em 2em auto auto;
        padding:  1em 2em;
        border-radius: 2em;
        border: .375em solid currentcolor;
      }
      .tradingpair
      {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: space-around;
      }
      .tradingpair [data-pair]
      {
        flex: 0 0 100%;
      }
    </style>
  </head>
  <body>
    <div id="__app">
      
      <!-- DISPLAY CLOCK -->
      <div id="time" class="container">
        <span class="spacer"></span>
        <span class="spacer"></span>
        <h2 data-timelocale id="__time">00:00</h2>
      </div>
      
      <!-- FIAT GROUP -->
      <div id="__fiats" class="group">
        <!-- BTCEUR -->
        <div id="BTCEUR" class="tradingpair">
          <h3 data-pair>BTCEUR</h3>
          <h3 data-price>0.000000</h3>
          <p data-eur>€0.00</p>
          <h3 data-change>0.00%</h3>
        </div>
        <!-- BTCBUSD -->
        <div id="BTCBUSD" class="tradingpair">
          <h3 data-pair>BTCBUSD</h3>
          <h3 data-price>0.000000</h3>
          <p data-eur>€0.00</p>
          <h3 data-change>0.00%</h3>
        </div>
      </div>
      
      <!-- COIN GROUP -->
      <div id="__coins" class="group">
        <!-- CAKEBTC -->
        <div id="CAKEBTC" class="tradingpair">
          <h3 data-pair>CAKEBTC</h3>
          <h3 data-price>0.000000</h3>
          <p data-eur>€0.00</p>
          <h3 data-change>0.00%</h3>
        </div>
        <!-- RUNEBTC -->
        <div id="RUNEBTC" class="tradingpair">
          <h3 data-pair>RUNEBTC</h3>
          <h3 data-price>0.000000</h3>
          <p data-eur>€0.00</p>
          <h3 data-change>0.00%</h3>
        </div>
        <!-- ICPBTC -->
        <div id="ICPBTC" class="tradingpair">
          <h3 data-pair>ICPBTC</h3>
          <h3 data-price>0.000000</h3>
          <p data-eur>€0.00</p>
          <h3 data-change>0.00%</h3>
        </div>
      </div>

      <!-- HIDDEN GROUP -->
      <div style="visibility: hidden;">
        <!-- EURBUSD -->
        <div id="EURBUSD" class="tradingpair">
          <h3 data-pair>EURBUSD</h3>
          <h3 data-price>0.000000</h3>
          <p data-eur>€0.00</p>
          <h3 data-change>0.00%</h3>
        </div>
      </div>

    </div>

    <script type="text/javascript">
      
      const base = 'https://api.binance.com/';
      const route = 'api/v3/ticker/24hr?symbol=';
      
      const params =
      { 
        interval: 5000,
        symbols: [
          'EURBUSD',
          'BTCEUR',
          'BTCBUSD',
          'CAKEBTC',
          'RUNEBTC',
          'ICPBTC'
        ]
      }
      let rates =
      {
        EUR: 0.00,
        EURBUSD: 0.00
      };

      const getTick = async symbol =>
      {
        if ( typeof( symbol ) === undefined || symbol === 'undefined') return
        const Rounded = n =>
        {
          return Math.round ( ( n + Number.EPSILON ) * 100 ) / 100
        }
        const pair = document.body.querySelector( `#${symbol}` )
        const tick = pair.querySelector( `[data-price]` )
        const euro = pair.querySelector( `[data-eur]` )
        const percent = pair.querySelector( `[data-change]` )

        const endpoint = base + route + symbol
        const data = await fetch( endpoint, { method: 'get' } )
        const response = await data.json();
        const { weightedAvgPrice, priceChangePercent } = response;

        tick.innerText = `${ weightedAvgPrice }`;
        percent.innerText = `${ ( Math.round( priceChangePercent * 100 ) ) / 100 }%`;
        
        if ( symbol === 'EURBUSD' ) rates['EURBUSD'] = weightedAvgPrice
        if ( symbol === 'BTCEUR' ) rates['EUR'] = weightedAvgPrice
        
        euro.innerText = ( symbol === 'BTCBUSD' ? `€${ weightedAvgPrice / rates['EURBUSD'] }` : `€${ Rounded( weightedAvgPrice * rates['EUR'] ) }` );
        
        const setStyle = ( parent, value ) =>
        {
          parent.style.color = ( value > 0 ? 'green' : ( value < 0 ? 'red' : ( value === 0 ? 'gray' : 'yellow' ) ) );  
        }
        setStyle( percent, priceChangePercent )
        return
      }

      const step = interval =>
      { 
        setTimeout( () => { update() }, interval );
      }

      const update = () =>
      {
        const clock = document.body.querySelector( `[data-timelocale]` );
        clock.innerText = new Date().toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit' });
        params.symbols.forEach( symbol =>
        {
          getTick( symbol );
        });
        step( params.interval );
        return
      }

      document.addEventListener('DOMContentLoaded', () =>
      {
        update();
      }, 
      true 
      );
    </script>
  </body>
</html>
