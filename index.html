<!DOCTYPE html lang="en">
  <head>
    <meta http-equiv="Content-Type" Content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1.0, viewport-fit=cover" />
    <title>Wallpaper Engine Project | with Binance API</title>
    <style type="text/css">
      :root
      {
        --theme-color: rgb( 255 255 255 / 99 );
        --bg-color: rgb( 8 8 8 / 99 );
      }
      *
      {
        margin:  0;
        padding: 0;
        text-decoration: none;
        list-style: none;
      }
      html, body
      {
        color: var( --theme-color );
        background-color: var( --bg-color );
        font-family: monospace;
        background-image: linear-gradient( 17deg, rgb( 2 4 3 / 99 ), rgb( 8 8 8 / 91 ), rgb( 41 41 41 / 87 ), rgb( 2 4 3 / 99 ) );
        background-image: url( kirk-thornton-2-XeULGIEmg-unsplash.jpg );
        background-repeat: none;
        background-position: bottom right;
        background-size: cover;
      }
      #__app
      {
        width: 380px;
        margin: 0 2vw auto auto;
      }

      #__time
      {
        display: grid;
        justify-content: center;
        font-size: 600%;
        font-weight: 100;
        padding: .5em 0;
      }

      .exchange
      {
        display: block;
        position: relative;
        margin: 1em auto;
        padding: 1em 2em;
        border-radius: .75em;
        border: .175em solid currentcolor;
        font-size:  140%;

      }
      .fiat, .coin
      {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: space-between;
      }

      .exchange [data-pair], .exchange [data-percent], .exchange [data-price], .exchange [data-fiat]
      {
        flex: 0 0 50%;
        overflow: visible;
        max-width: 50%;
      }
      
      .exchange [data-percent], .exchange [data-fiat]
      {
        text-align: end;
        align-self: flex-end;
      }
      
      .exchange [data-change]
      {
        flex: 0 0 100%;
        text-align: start;
        align-self: flex-start;
      }
      
      .exchange .coin [data-change]
      {
        visibility: hidden;
      }

    </style>
  </head>
  <body>
    <div id="__app">
      
      <!-- DISPLAY CLOCK -->
      <h2 data-timelocale id="__time">00:00</h2>
      
      <!-- FIAT GROUP -->
      <div id="__fiats" class="exchange">
        <!-- BTCEUR -->
        <div id="BTCEUR" class="fiat">
          <h3 data-pair>BTCEUR</h3>
          <h3 data-percent>0.00%</h3>
          <h3 data-price>0.000000</h3>
          <p data-fiat>$0.00</p>
          <h6 data-change>-</h6>
        </div>
        <!-- BTCBUSD -->
        <div id="BTCBUSD" class="fiat">
          <h3 data-pair>BTCBUSD</h3>
          <h3 data-percent>0.00%</h3>
          <h3 data-price>0.000000</h3>
          <p data-fiat>$0.00</p>
          <h6 data-change>-</h6>
        </div>
      </div>
      
      <!-- COIN GROUP -->
      <div id="__coins" class="exchange">
        <!-- CAKEBTC -->
        <div id="CAKEBTC" class="coin">
          <h3 data-pair>CAKEBTC</h3>
          <h3 data-percent>0.00%</h3>
          <h3 data-price>0.000000</h3>
          <p data-fiat>$0.00</p>
          <h6 data-change>-</h6>
        </div>
        <!-- RUNEBTC -->
        <div id="RUNEBTC" class="coin">
          <h3 data-pair>RUNEBTC</h3>
          <h3 data-percent>0.00%</h3>
          <h3 data-price>0.000000</h3>
          <p data-fiat>$0.00</p>
          <h6 data-change>-</h6>
        </div>
        <!-- ICPBTC -->
        <div id="ICPBTC" class="coin">
          <h3 data-pair>ICPBTC</h3>
          <h3 data-percent>0.00%</h3>
          <h3 data-price>0.000000</h3>
          <p data-fiat>$0.00</p>
          <h6 data-change>-</h6>
        </div>
      </div>

      <!-- HIDDEN GROUP -->
      <div style="visibility: hidden;">
        <!-- EURBUSD -->
        <div id="EURBUSD" class="coin">
          <h3 data-pair>EURBUSD</h3>
          <h3 data-price>0.000000</h3>
          <p data-fiat>$0.00</p>
          <h3 data-percent>0.00%</h3>
          <h5 data-change style="visibility:hidden;">~</h5>
        </div>
      </div>

    </div>

    <script type="text/javascript">
      
      const base = 'https://api.binance.com/';
      const route = 'api/v3/ticker/24hr?symbol=';
      
      const params =
      { 
        interval: 5000,
        symbols: [
          'EURBUSD',
          'BTCEUR',
          'BTCBUSD',
          'CAKEBTC',
          'RUNEBTC',
          'ICPBTC'
        ],
        fiat: 'busd'
      }
      let rates =
      {
        EUR: 0.00,
        EURBUSD: 0.00
      };

      const getTick = async symbol =>
      {
        if ( typeof( symbol ) === undefined || symbol === 'undefined') return
        const Rounded = n =>
        {
          return Math.round ( ( n + Number.EPSILON ) * 100 ) / 100
        }
        const pair = document.body.querySelector( `#${symbol}` )
        const tick = pair.querySelector( `[data-price]` )
        const fiat = pair.querySelector( `[data-fiat]` )
        const percent = pair.querySelector( `[data-percent]` )
        const change = pair.querySelector( `[data-change]` )

        const endpoint = base + route + symbol
        const data = await fetch( endpoint, { method: 'get' } )
        const response = await data.json();
        const { weightedAvgPrice, priceChange, priceChangePercent } = response;

        tick.innerText = `${ weightedAvgPrice }`;
        change.innerText = `${ priceChange }`;
        percent.innerText = `${ ( Math.round( priceChangePercent * 100 ) ) / 100 }%`;
        
        if ( symbol === 'EURBUSD' ) rates['EURBUSD'] = weightedAvgPrice
        if ( symbol === 'BTCEUR' ) rates['EUR'] = weightedAvgPrice
        
        const EUR = ( symbol === 'BTCBUSD' ? Rounded( weightedAvgPrice / rates['EURBUSD'] ) : ( symbol === 'BTCEUR' ? Math.round( weightedAvgPrice * 100 ) / 100 : Rounded( weightedAvgPrice * rates['EUR'] ) ) );
        const BUSD = Rounded( EUR * rates['EURBUSD'] );

        fiat.innerText = ( params.fiat === 'busd' ? `$${BUSD}` : ( params.fiat === 'eur' ? `â‚¬${EUR}` : '-' ) );
        
        const setStyle = parent =>
        {
          parent.style.color = ( priceChangePercent > 0 ? 'green' : ( priceChangePercent < 0 ? 'red' : ( priceChangePercent === 0 ? 'gray' : 'var( --theme-color );' ) ) );  
        }
        
        setStyle( percent );
        return
      }

      const step = interval =>
      { 
        setTimeout( () => { update() }, interval );
      }

      const update = () =>
      {
        const clock = document.body.querySelector( `[data-timelocale]` );
        clock.innerText = new Date().toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit' });
        params.symbols.forEach( symbol =>
        {
          getTick( symbol );
        });
        step( params.interval );
        return
      }

      document.addEventListener('DOMContentLoaded', () =>
      {
        update();
      }, 
      true 
      );
    </script>
  </body>
</html>
