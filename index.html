<!DOCTYPE html lang="en">
  <head>
    <meta http-equiv="Content-Type" Content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1.0, viewport-fit=cover" />
    <title>Wallpaper Engine Project | with Binance API</title>
  </head>
  <body>
    <div id="__app">
      <!-- BTCEUR -->
      <div id="BTCEUR" style="visibility: collapse;">
        <h3 data-pair>BTC EUR</h3>
        <h3 data-price>0.000000</h3>
        <p data-eur>€0.00</p>
        <h3 data-change>0.00%</h3>
      </div>
      <!-- ## -->
      <!-- BTCBUSD -->
      <div id="BTCBUSD">
        <h3 data-pair>BTCBUSD</h3>
        <h3 data-price>0.000000</h3>
        <p data-eur>€0.00</p>
        <h3 data-change>0.00%</h3>
      </div>
      <!-- ## -->
      <!-- CAKEBTC -->
      <div id="CAKEBTC">
        <h3 data-pair>CAKEBTC</h3>
        <h3 data-price>0.000000</h3>
        <p data-eur>€0.00</p>
        <h3 data-change>0.00%</h3>
      </div>
      <!-- ## -->
      <!-- RUNEBTC -->
      <div id="RUNEBTC">
        <h3 data-pair>RUNEBTC</h3>
        <h3 data-price>0.000000</h3>
        <p data-eur>€0.00</p>
        <h3 data-change>0.00%</h3>
      </div>
      <!-- ## -->
      <!-- ICPBTC -->
      <div id="ICPBTC">
        <h3 data-pair>ICPBTC</h3>
        <h3 data-price>0.000000</h3>
        <p data-eur>€0.00</p>
        <h3 data-change>0.00%</h3>
      </div>
      <!-- ## -->
    </div>
    <script type="text/javascript">
      
      const base = 'https://api.binance.com/';
      const route = 'api/v3/ticker/24hr?symbol=';
      
      const params =
      { 
        interval: 5000,
        symbols: [
          'BTCEUR',
          'BTCBUSD',
          'CAKEBTC',
          'RUNEBTC',
          'ICPBTC'
        ]
      }
      let euroEx;

      const getTick = async symbol =>
      {
        if ( typeof( symbol ) === undefined || symbol === 'undefined') return
        
        const pair = document.body.querySelector( `#${symbol}` )
        const tick = pair.querySelector( `[data-tick]` )
        const euro = pair.querySelector( `[data-eur]` )
        const percent = pair.querySelector( `[data-change]` )

        const endpoint = base + route + symbol
        const data = await fetch( endpoint, { method: 'get' } )
        const response = await data.json();
        const { weightedAvgPrice, priceChangePercent } = response;

        tick.innerText = `${weightedAvgPrice}`;
        percent.innerText = `${priceChangePercent}%`;
        
        if ( symbol === 'BTCEUR' ) { euroEx = weightedAvgPrice } else       
        {
          euro.innerText = `€${weightedAvgPrice * euroEx}`
        }
        const setStyle = ( parent, value ) =>
        {
          parent.style.color = ( value > 0 ? 'green' : ( value < 0 ? 'red' : ( value === 0 ? : 'gray' : 'yellow' ) ) );  
        }
        setStyle( pair, priceChangePercent )
        return
      }

      const step = interval => { setTimeout( update(), interval ); }

      const update = () =>
      {
        params.symbols.forEach( symbol =>
        {
          getTick( symbol );
        });
        step( params.interval );
        return
      }

      document.addEventListener('DOMContentLoaded', () =>
      {
        // const app = document.createElement( 'div');
        // document.body.appendChild( app );
        
        // params.symbols.forEach( symbol =>
        // {
        //   const __crypto = document.createElement( 'div' );
        //   app.appendChild( __crypto );
        //   crypto.innerHTML = `
        //     <h3 id="${symbol}">${symbol}</h3>
        //     <h3 id="${symbol}__price">0.0000000</h3>
        //     <h3 id="${symbol}__percent">0.00%</h3>
        //   `;
        // });
        update();
      }, true );
    </script>
  </body>
</html>
